@if (loading || submitting) {
<app-loader [message]="loaderMessage"></app-loader>
} @if(!loading) {
<div class="flex-space mb-3">
  <h5 class="">Roles</h5>
  <button class="float-end" cButton color="primary" [cModalToggle]="roleModal.id">Add Role</button>
</div>
<table cTable responsive>
  <thead>
    <tr>
      <th>#</th>
      <th>Name</th>
      <th>Total Permissions</th>
      <th>Created By</th>
      <th>Created On</th>
      <th>Status</th>
      <th>Action</th>
    </tr>
  </thead>
  @if(paginatedData.length > 0) {
  <tbody>
    @for (role of paginatedData; track $index) {
    <tr>
      <td>{{ (currentPage - 1) * pageSize + $index + 1 }}</td>
      <td>{{ role.name }}</td>
      <td>{{ role.permissions.length }}</td>
      <td>
        {{ role.createdBy?.name }}
        @if (role.createdBy?.role) {
        <span
          ><c-badge color="primary">{{ role.createdBy?.role.name }}</c-badge></span
        >
        }
      </td>
      <td>
        <span>{{ role.createdAt | date : "mediumDate" }} </span>
        <span>{{ role.createdAt | date : "shortTime" }}</span>
      </td>
      <td>
        <c-form-check [switch]="true">
          <input cFormCheckInput [checked]="role.isActive" type="checkbox" [disabled]="role.isSystemRole" />
        </c-form-check>
      </td>
      <td class="d-flex gap-4">
        <button cButton color="info" size="sm">Update</button>
        <button cButton color="danger" size="sm" [disabled]="role.isSystemRole">Delete</button>
      </td>
    </tr>
    }
  </tbody>
  } @if (paginatedData.length === 0) {
  <tbody>
    <tr>
      <td colspan="100%" class="text-center py-4">No Modules found</td>
    </tr>
  </tbody>
  }
</table>
} @if(!loading && paginatedData.length > 0) {
<c-pagination align="center">
  <li class="pagination-item" cPageItem [disabled]="currentPage === 1">
    <a cPageLink class="pointer" (click)="changePage(currentPage - 1)">Prev</a>
  </li>
  @for (_ of pagesArray; track $index) {
  <li class="pagination-item" cPageItem [active]="currentPage === $index + 1">
    <a cPageLink class="pointer" (click)="changePage($index + 1)">{{ $index + 1 }}</a>
  </li>
  }
  <li class="pagination-item" cPageItem [disabled]="currentPage === totalPages">
    <a cPageLink class="pointer" (click)="changePage(currentPage + 1)">Next</a>
  </li>
</c-pagination>
}
<c-modal #roleModal backdrop="static" size="xl" alignment="center" id="roleModal" [(visible)]="showModal">
  <c-modal-header>
    <h5 cModalTitle>{{ isModalForUpdate ? "Update" : "New" }} Role</h5>
  </c-modal-header>
  <c-modal-body>
    <c-row>
      <c-col>
        <form cForm>
          <div class="mb-2">
            <label cLabel for="roleName">Name</label>
            <input cFormControl id="roleName" name="roleName" type="text" [(ngModel)]="roleForm.name" />
          </div>
          <div class="mb-2">
            <label cLabel for="roleDescription">Description</label>
            <textarea
              cFormControl
              id="roleDescription"
              name="roleDescription"
              rows="10"
              [(ngModel)]="roleForm.description"
            ></textarea>
          </div>
          <div class="mb-3">
            <c-form-check class="d-flex gap-2">
              <input
                cFormCheckInput
                id="systemRole"
                name="systemRole"
                type="checkbox"
                [(ngModel)]="roleForm.isSystemRole"
              />
              <label cFormCheckLabel for="systemRole">Keep this as System Role</label>
            </c-form-check>
          </div>
        </form>
      </c-col>
      <c-col>
        <div class="permissions-container">
          @for (module of modules; track module) {
          <div class="chips-container-wrapper mb-3">
            <div class="chips-container">
              <label
                >{{ module.name }} ({{ getSelectedCount(module.permissions) }} /
                {{ getSortedPermissions(module.permissions).length }})</label
              >
              <div class="chips-container">
                @for (permission of getSortedPermissions(module.permissions); track $index) {
                <div class="chip px-2 py-1" [class.active]="isSelected(permission)" (click)="toggleChip(permission)">
                  {{ permission.label }}
                </div>
                }
              </div>
            </div>
          </div>
          }
        </div>
      </c-col>
    </c-row>
  </c-modal-body>
  <c-modal-footer>
    <button (click)="closeModal(true)" cButton color="secondary">Close</button>
    <button cButton color="primary" (click)="process()">{{ isModalForUpdate ? "Update" : "Create" }}</button>
  </c-modal-footer>
</c-modal>
