@if (loading || submitting) {
<app-loader></app-loader>
} @else {
<!-- Table starting -->
<p-table
  #dt
  [value]="navigationItems"
  dataKey="_id"
  [paginator]="true"
  showGridlines
  [rows]="10"
  [rowsPerPageOptions]="[5, 10, 25]"
  [globalFilterFields]="['title', 'route', 'requiredPermission', 'type', 'isActive']"
  filterDisplay="menu"
  (sortFunction)="customSort($event)"
  [customSort]="true"
>
  <!-- Global Search -->
  <ng-template pTemplate="caption">
    <div class="flex-top-center gap-2">
      <h5 class="mb-0">Navigation</h5>
      <input
        pInputText
        type="text"
        placeholder="Global search"
        (input)="dt.filterGlobal($any($event.target).value, 'contains')"
        class="ms-auto"
      />
      @if(canDo.create){
      <button pButton size="small" [cModalToggle]="navigationModal.id">
        <i class="pi pi-plus" pButtonIcon></i>
        <span pButtonLabel>New</span>
      </button>
      }
    </div>
  </ng-template>

  <!-- Header -->
  <ng-template pTemplate="header">
    <tr>
      <!-- Navigation Title -->
      <th style="width: 150px" pSortableColumn="title">
        <div class="flex-space">
          <div class="d-flex gap-3">
            <h6>Title</h6>
            <p-sortIcon field="title"></p-sortIcon>
          </div>
          <p-columnFilter
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
            type="text"
            field="title"
            matchMode="contains"
            display="menu"
          />
        </div>
      </th>
      <!-- Route -->
      <th style="width: 160px" pSortableColumn="route">
        <div class="flex-space">
          <div class="d-flex gap-3">
            <h6>Route</h6>
            <p-sortIcon field="route"></p-sortIcon>
          </div>
          <p-columnFilter
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
            type="text"
            field="route"
            matchMode="contains"
            display="menu"
          />
        </div>
      </th>
      <!-- Navigation Required Permission -->
      <th style="width: 180px" pSortableColumn="requiredPermission">
        <div class="flex-space">
          <div class="d-flex gap-3">
            <h6>Permission</h6>
            <p-sortIcon field="requiredPermission"></p-sortIcon>
          </div>
          <p-columnFilter
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
            type="text"
            field="requiredPermission"
            matchMode="contains"
            display="menu"
          />
        </div>
      </th>
      <!-- Navigation Type -->
      <th style="width: 100px" pSortableColumn="type">
        <div class="flex-space">
          <div class="d-flex gap-3">
            <h6>Type</h6>
            <p-sortIcon field="type"></p-sortIcon>
          </div>
          <p-columnFilter
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
            type="text"
            field="type"
            matchMode="contains"
            display="menu"
          />
        </div>
      </th>
      <!-- Navigation Active Status -->
      <th style="width: 120px">
        <div class="flex-space">
          <h6>Status</h6>
          <p-columnFilter
            field="isActive"
            matchMode="equals"
            display="menu"
            [showMatchModes]="false"
            [showOperator]="false"
            [showAddButton]="false"
          >
            <ng-template #filter let-value let-filter="filterCallback">
              <p-select
                [options]="statuses"
                placeholder="Any"
                (onChange)="filter($event.value)"
                optionLabel="name"
                optionValue="value"
              >
                <ng-template let-status #item>
                  <div class="flex items-center gap-2">
                    <span>{{ status.name }}</span>
                  </div>
                </ng-template>
              </p-select>
            </ng-template>
          </p-columnFilter>
        </div>
      </th>
      <!-- Navigation Actions -->
      @if(canDo.update || canDo.delete){
      <th style="width: 200px">
        <h6>Actions</h6>
      </th>
      }
    </tr>
  </ng-template>

  <!-- Body -->
  <ng-template pTemplate="body" let-navigationItem let-index="rowIndex">
    <tr>
      <td class="text-truncate" [title]="navigationItem.title">
        @if(navigationItem.type === 'MENU'){
        <svg cIcon class="me-2" [name]="navigationItem.icon" size="lg"></svg>
        }
        {{ navigationItem.title }}
      </td>
      <td class="text-truncate" [title]="navigationItem.route">{{ navigationItem.route || "-" }}</td>
      <td class="text-truncate" [title]="navigationItem.requiredPermission">
        {{ navigationItem.requiredPermission || "-" }}
      </td>
      <td class="text-truncate" [title]="navigationItem.type">{{ navigationItem.type }}</td>
      <td>
        <c-form-check [switch]="true" sizing="xl">
          <input
            cFormCheckInput
            [checked]="navigationItem.isActive"
            [(ngModel)]="navigationItem.isActive"
            type="checkbox"
            (click)="updateStatus($event, navigationItem)"
            [disabled]="!canDo.update"
          />
        </c-form-check>
      </td>
      @if(canDo.update || canDo.delete){
      <td class="d-flex gap-3">
        @if(canDo.update){
        <p-button label="Update" severity="info" size="small" />
        } @if(canDo.delete){
        <p-button label="Delete" severity="danger" size="small" (click)="confirmDelete(navigationItem._id, index)" />
        }
      </td>
      }
    </tr>
  </ng-template>

  <!-- No Data template -->
  <ng-template #emptymessage>
    <tr>
      <td colspan="6">No navigation items found.</td>
    </tr>
  </ng-template>
</p-table>
}
<!-- New/Update modal -->
<c-modal #navigationModal backdrop="static" alignment="center" id="navigationModal" [(visible)]="showModal"> </c-modal>
